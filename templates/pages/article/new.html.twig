{% extends "base.html.twig" %}

{% block title %}AchatRevente - Nouvelle annonce
{% endblock %}

{% block body %}
	<div class="container">

		<h1 class="mt-4">Création d'une annonce</h1>

		{{ form_start(form) }}

		<div class="form-group">
			{{ form_label(form.title) }}
			{{ form_widget(form.title) }}
			<div class="form-error">
				{{ form_errors(form.title) }}
			</div>
		</div>

		<div class="form-group">
			{{ form_label(form.description) }}
			{{ form_widget(form.description) }}
			<div class="form-error">
				{{ form_errors(form.description) }}
			</div>
		</div>

		<div class="form-group">
			{{ form_label(form.price) }}
			{{ form_widget(form.price) }}
			<div class="form-error">
				{{ form_errors(form.price) }}
			</div>
		</div>
			<div class="form-group mt-4">
			{{ form_widget(form.isPublic) }}
			{{ form_label(form.isPublic) }}
			<div class="form-error">
				{{ form_errors(form.isPublic) }}
			</div>
		</div>

        <div class="form-group">
			{{ form_label(form.postCode) }}
			{{ form_widget(form.postCode) }}
			<div class="form-error">
				{{ form_errors(form.postCode) }}
			</div>
		</div>

        <div class="form-group">
			{{ form_label(form.city) }}
			{{ form_widget(form.city) }}
			<div class="form-error">
				{{ form_errors(form.city) }}
			</div>
		</div>

		<div class="form-group" style="margin-bottom:10px;">
			<h2>Ajouter des images</h2>
			<h4>ctrl + click gauche souris pour séléctioner plusieurs photo</h4>
			{{ form_label(form.images) }}
			{{ form_widget(form.images, {'attr': {'class': 'image-collection', 'data-index': form.images|length}}) }}
			<div class="form-error">
				{{ form_errors(form.images) }}
			</div>
		</div>
        
          <div class="form-group">
			{{ form_label(form.categorie) }}
			{{ form_widget(form.categorie) }}
			<div class="form-error">
				{{ form_errors(form.categorie) }}
			</div>
		</div>

          <div class="form-group">
			{{ form_label(form.subCategorie) }}
			{{ form_widget(form.subCategorie) }}
			<div class="form-error">
				{{ form_errors(form.subCategorie) }}
			</div>
		</div> 
        <div id="voituresDiv" style="display:none;">
            {{ form_label(form.voitures) }}
            {{ form_widget(form.voitures) }}
        </div>

        <div id="motosDiv" style="display:none;">
            {{ form_label(form.motos) }}
            {{ form_widget(form.motos) }}
        </div>

        <div id="camionsDiv" style="display:none;">
            {{ form_label(form.camions) }}
            {{ form_widget(form.camions) }}
        </div>

        <div id="caravanningDiv" style="display:none;">
            {{ form_label(form.caravanning) }}
            {{ form_widget(form.caravanning) }}
        </div>


		{{ form_end(form) }}
	</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	 <script>

//permet de choisir les options selon les associations 
   $(document).ready(function() {
    const $categorieSelect = $("#article_categorie");
    const $subCategorieSelect = $("#article_subCategorie");
    const $makeOfCarSelect = $("#article_voitures_makeOfCar");
    const $carModelSelect = $("#article_voitures_carModel");
    const $makeOfMotoSelect = $("#article_motos_makeOfMoto");
    const $motoModelSelect = $("#article_motos_motoModel");

    const appendOptions = (data, $selectElement, placeholderName) => {
        $selectElement.empty();
        const optPlaceholder = $('<option>', {
            value: "",
            text: `Choisir ${placeholderName}...`
        });
        $selectElement.append(optPlaceholder);
        $.each(data, (index, item) => {
            const opt = $('<option>', {
                value: item.id,
                text: item.name
            });
            $selectElement.append(opt);
        });
    };

    const handleError = error => {
        console.error("An error occurred:", error);
    };

    const fetchOptions = (url, $selectElement, placeholderName) => {
        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            success: data => appendOptions(data, $selectElement, placeholderName),
            error: handleError
        });
    };

    $categorieSelect.on("change", function() {
        const selectedOption = $(this).find("option:selected").text();
        const url = `/get-subCategories/${$(this).val()}`;
        fetchOptions(url, $subCategorieSelect, selectedOption);
    });

    $makeOfCarSelect.on("change", function() {
        const selectedOption = $(this).find("option:selected").text();
        const url = `/get-carModels/${$(this).val()}`;
        fetchOptions(url, $carModelSelect, selectedOption);
    });

    $makeOfMotoSelect.on("change", function() {
        const selectedOption = $(this).find("option:selected").text();
        const url = `/get-motoModels/${$(this).val()}`;
        fetchOptions(url, $motoModelSelect, selectedOption);
    });

});


//     $('#article_subCategorie').on('change', function() {
//     const selectedSubCategory = $(this).val(); 
//     console.log("La sous-catégorie a changé à: " + selectedSubCategory);
//     //permet de rendre les champs obligé selon la sous catégorie choisie 
//     //si je choisi sous catégorie voiture donc les input qui se trouve dans voituretype seront obligé 
//     //d'etre rempli les autres champs n'auront pas d'obligation 
//     if (selectedSubCategory === '1') {  // "Voitures"
//         //avec display on permet d'affiché uniquement voituretype les autre sous catégorie sont en
//         //display none
//         $('#voituresDiv').css("display", "block"); 
//         $('#article_motos :input').removeAttr('required');
//         $('#article_voitures :input').attr('required', 'required');
//     } else {
//         $('#voituresDiv').css("display", "none"); 
//         $('#article_voitures :input').removeAttr('required');
//         $('#article_motos :input').attr('required', 'required');
//     }

//    if (selectedSubCategory === '2') {  // "Motos"
//      $('#motosDiv').css("display", "block"); 
//         $('#article_voitures :input').removeAttr('required');
//         $('#article_motos :input').attr('required', 'required');
//     } else {
//          $('#motosDiv').css("display", "none"); 
//         $('#article_motos :input').removeAttr('required');
//         $('#article_voitures :input').attr('required', 'required');
//     }
    
//     });

$('#article_subCategorie').on('change', function() {
    const selectedSubCategory = $(this).val(); 
    console.log("La sous-catégorie a changé à: " + selectedSubCategory);

    // Hide all divs and remove 'required' from all inputs first
$('#voituresDiv, #motosDiv, #camionsDiv, #caravanningDiv').css("display", "none");
$('#article_voitures :input, #article_motos :input, #article_caravanning :input, #article_camions :input').removeAttr('required');


    switch (selectedSubCategory) {
        case '1':  // "Voitures"
            $('#voituresDiv').css("display", "block");
            $('#article_voitures :input').attr('required', 'required');
            break;
        
        case '2':  // "Motos"
            $('#motosDiv').css("display", "block");
            $('#article_motos :input').attr('required', 'required');
            break;

        case '3':  // "Camion"
            $('#camionsDiv').css("display", "block");
            $('#article_camions :input').attr('required', 'required');
            break;

         case '7':  // "Caravaning"
            $('#caravanningDiv').css("display", "block");
            $('#article_caravanning :input').attr('required', 'required');
            break;
    }
});


    


//le champ sous-catégorie ne peut être selectioné avant catégorie 
$(document).ready(function() {
    
    // Initially disabling the sub-category and car model dropdowns
    $("#article_subCategorie").prop("disabled", true);
    $("#article_voitures_carModel").prop("disabled", true);
    $("#article_motos_motoModel").prop("disabled", true);

    function toggleDependentDropdown($mainSelect, $dependentSelect) {
        $mainSelect.on("change", function() {
            if ($(this).val()) {
                $dependentSelect.prop("disabled", false);
            } else {
                $dependentSelect.prop("disabled", true);
            }
        });
    }

    // Sous catégorie
    toggleDependentDropdown($("#article_categorie"), $("#article_subCategorie"));

    // Model Auto
    toggleDependentDropdown($("#article_voitures_makeOfCar"), $("#article_voitures_carModel"));

    // Model Moto
    toggleDependentDropdown($("#article_motos_makeOfMoto"), $("#article_motos_motoModel"));

});


    
    </script>

{% endblock %}
